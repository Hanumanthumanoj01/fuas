<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:camunda="http://camunda.org/schema/1.0/bpmn"
             xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
             xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
             xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
             id="Definitions_1"
             targetNamespace="http://bpmn.io/schema/bpmn">

  <!-- ================= PROCESS ================= -->
  <process id="service-request-process"
           name="External Service Procurement V2"
           isExecutable="true"
           camunda:historyTimeToLive="P180D">

    <startEvent id="StartEvent_1" name="Request Received (1B)">
      <outgoing>Flow_1</outgoing>
    </startEvent>

    <serviceTask id="Activity_CheckContract"
                 name="Validate Contract"
                 camunda:delegateExpression="${checkContractDelegate}">
      <incoming>Flow_1</incoming>
      <outgoing>Flow_2</outgoing>
    </serviceTask>

    <exclusiveGateway id="Gateway_Contract_Valid" name="Contract Valid?">
      <incoming>Flow_2</incoming>
      <outgoing>Flow_3</outgoing>
      <outgoing>Flow_4</outgoing>
    </exclusiveGateway>

    <serviceTask id="Activity_Notify_Contract_Rejection"
                 name="Notify 1B (Contract Missing)"
                 camunda:delegateExpression="${notifyContractRejectionDelegate}">
      <incoming>Flow_3</incoming>
      <outgoing>Flow_5</outgoing>
    </serviceTask>

    <endEvent id="End_NoContract" name="Process Terminated"/>

    <userTask id="Activity_PO_Approval"
              name="Approve Request (PO)"
              camunda:assignee="po_user">
      <incoming>Flow_4</incoming>
      <outgoing>Flow_6</outgoing>
    </userTask>

    <exclusiveGateway id="Gateway_Approved" name="Approved?">
      <incoming>Flow_6</incoming>
      <outgoing>Flow_7</outgoing>
      <outgoing>Flow_8</outgoing>
    </exclusiveGateway>

    <userTask id="Activity_PM_Fix"
              name="Fix Request (PM)"
              camunda:assignee="pm_user">
      <incoming>Flow_7</incoming>
      <outgoing>Flow_6</outgoing>
    </userTask>

    <serviceTask id="Activity_Publish"
                 name="Publish to Providers"
                 camunda:delegateExpression="${publishToProvidersDelegate}">
      <incoming>Flow_8</incoming>
      <outgoing>Flow_9</outgoing>
    </serviceTask>

    <userTask id="Activity_PM_Evaluate"
              name="Evaluate Offers (PM)"
              camunda:assignee="pm_user">
      <incoming>Flow_9</incoming>
      <outgoing>Flow_10</outgoing>
    </userTask>

    <userTask id="Activity_PO_Validate"
              name="Validate Selection (PO)"
              camunda:assignee="po_user">
      <incoming>Flow_10</incoming>
      <outgoing>Flow_11</outgoing>
    </userTask>

    <exclusiveGateway id="Gateway_Selection_Approved" name="Selection Valid?">
      <incoming>Flow_11</incoming>
      <outgoing>Flow_12</outgoing>
      <outgoing>Flow_13</outgoing>
    </exclusiveGateway>

    <serviceTask id="Activity_Notify_1b"
                 name="Send Recommendation to 1B"
                 camunda:delegateExpression="${notify1bRecommendationDelegate}">
      <incoming>Flow_12</incoming>
      <outgoing>Flow_14</outgoing>
    </serviceTask>

    <receiveTask id="Event_Wait_1b"
                 name="Wait for 1B Decision"
                 messageRef="Message_1b_Decision"
                 camunda:asyncBefore="true">
      <incoming>Flow_14</incoming>
      <outgoing>Flow_15</outgoing>
    </receiveTask>

    <exclusiveGateway id="Gateway_1b_Decision" name="1B Decision?">
      <incoming>Flow_15</incoming>
      <outgoing>Flow_16</outgoing>
      <outgoing>Flow_17</outgoing>
    </exclusiveGateway>

    <serviceTask id="Activity_Notify_Reject"
                 name="Notify Provider (Rejected)"
                 camunda:delegateExpression="${notifyProviderRejectDelegate}">
      <incoming>Flow_16</incoming>
      <outgoing>Flow_18</outgoing>
    </serviceTask>

    <endEvent id="End_Rejected" name="Rejected"/>

    <userTask id="Activity_RP_Coordination"
              name="Confirm Logistics (RP)"
              camunda:assignee="rp_user">
      <incoming>Flow_17</incoming>
      <outgoing>Flow_19</outgoing>
    </userTask>

    <serviceTask id="Activity_CreateOrder"
                 name="Create Service Order"
                 camunda:delegateExpression="${createServiceOrderDelegate}">
      <incoming>Flow_19</incoming>
      <outgoing>Flow_20</outgoing>
    </serviceTask>

    <serviceTask id="Activity_Notify_Win"
                 name="Notify Provider (Win)"
                 camunda:delegateExpression="${notifyProviderDelegate}">
      <incoming>Flow_20</incoming>
      <outgoing>Flow_21</outgoing>
    </serviceTask>

    <serviceTask id="Activity_NotifyWorkforce"
                 name="Update Workforce System"
                 camunda:delegateExpression="${notifyWorkforceDelegate}">
      <incoming>Flow_21</incoming>
      <outgoing>Flow_22</outgoing>
    </serviceTask>

    <endEvent id="End_Success" name="Service Order Active"/>

    <!-- SEQUENCE FLOWS -->
    <sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="Activity_CheckContract"/>
    <sequenceFlow id="Flow_2" sourceRef="Activity_CheckContract" targetRef="Gateway_Contract_Valid"/>
    <sequenceFlow id="Flow_3" sourceRef="Gateway_Contract_Valid" targetRef="Activity_Notify_Contract_Rejection"/>
    <sequenceFlow id="Flow_4" sourceRef="Gateway_Contract_Valid" targetRef="Activity_PO_Approval"/>
    <sequenceFlow id="Flow_5" sourceRef="Activity_Notify_Contract_Rejection" targetRef="End_NoContract"/>
    <sequenceFlow id="Flow_6" sourceRef="Activity_PO_Approval" targetRef="Gateway_Approved"/>
    <sequenceFlow id="Flow_7" sourceRef="Gateway_Approved" targetRef="Activity_PM_Fix"/>
    <sequenceFlow id="Flow_8" sourceRef="Gateway_Approved" targetRef="Activity_Publish"/>
    <sequenceFlow id="Flow_9" sourceRef="Activity_Publish" targetRef="Activity_PM_Evaluate"/>
    <sequenceFlow id="Flow_10" sourceRef="Activity_PM_Evaluate" targetRef="Activity_PO_Validate"/>
    <sequenceFlow id="Flow_11" sourceRef="Activity_PO_Validate" targetRef="Gateway_Selection_Approved"/>
    <sequenceFlow id="Flow_12" sourceRef="Gateway_Selection_Approved" targetRef="Activity_Notify_1b"/>
    <sequenceFlow id="Flow_13" sourceRef="Gateway_Selection_Approved" targetRef="Activity_PM_Evaluate"/>
    <sequenceFlow id="Flow_14" sourceRef="Activity_Notify_1b" targetRef="Event_Wait_1b"/>
    <sequenceFlow id="Flow_15" sourceRef="Event_Wait_1b" targetRef="Gateway_1b_Decision"/>
    <sequenceFlow id="Flow_16" sourceRef="Gateway_1b_Decision" targetRef="Activity_Notify_Reject"/>
    <sequenceFlow id="Flow_17" sourceRef="Gateway_1b_Decision" targetRef="Activity_RP_Coordination"/>
    <sequenceFlow id="Flow_18" sourceRef="Activity_Notify_Reject" targetRef="End_Rejected"/>
    <sequenceFlow id="Flow_19" sourceRef="Activity_RP_Coordination" targetRef="Activity_CreateOrder"/>
    <sequenceFlow id="Flow_20" sourceRef="Activity_CreateOrder" targetRef="Activity_Notify_Win"/>
    <sequenceFlow id="Flow_21" sourceRef="Activity_Notify_Win" targetRef="Activity_NotifyWorkforce"/>
    <sequenceFlow id="Flow_22" sourceRef="Activity_NotifyWorkforce" targetRef="End_Success"/>

  </process>

  <message id="Message_1b_Decision" name="Message_1b_Decision"/>

</definitions>
